<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Learning Path</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Learning Path Debug Tool</h1>
    <div id="output"></div>
    
    <script>
        // Initialize Supabase client
        const supabaseUrl = 'YOUR_SUPABASE_URL';
        const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        async function debugLearningPath() {
            const output = document.getElementById('output');
            
            try {
                // Get the current user
                const { data: { user }, error: userError } = await supabase.auth.getUser();
                if (userError || !user) {
                    output.innerHTML = '<p style="color: red;">Please log in first</p>';
                    return;
                }
                
                output.innerHTML = '<p>Checking learning paths...</p>';
                
                // Get all learning paths for the user
                const { data: paths, error: pathsError } = await supabase
                    .from('learning_paths')
                    .select('*')
                    .eq('user_id', user.id)
                    .order('created_at', { ascending: false });
                
                if (pathsError) {
                    output.innerHTML = `<p style="color: red;">Error fetching paths: ${pathsError.message}</p>`;
                    return;
                }
                
                output.innerHTML += `<p>Found ${paths.length} learning paths</p>`;
                
                if (paths.length > 0) {
                    const latestPath = paths[0];
                    output.innerHTML += `<p>Latest path: ${latestPath.title} (ID: ${latestPath.id})</p>`;
                    
                    // Get learning path items for the latest path
                    const { data: items, error: itemsError } = await supabase
                        .from('learning_path_items')
                        .select('*')
                        .eq('path_id', latestPath.id)
                        .order('order_index');
                    
                    if (itemsError) {
                        output.innerHTML += `<p style="color: red;">Error fetching items: ${itemsError.message}</p>`;
                    } else {
                        output.innerHTML += `<p>Found ${items.length} learning path items</p>`;
                        
                        if (items.length > 0) {
                            output.innerHTML += '<h3>Learning Path Items:</h3><ul>';
                            items.forEach((item, index) => {
                                output.innerHTML += `<li>${index + 1}. ${item.title} (${item.item_type}) - ${item.estimated_hours}h</li>`;
                            });
                            output.innerHTML += '</ul>';
                        } else {
                            output.innerHTML += '<p style="color: orange;">No learning path items found! This is the issue.</p>';
                        }
                    }
                } else {
                    output.innerHTML += '<p style="color: orange;">No learning paths found</p>';
                }
                
            } catch (error) {
                output.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        // Run the debug function
        debugLearningPath();
    </script>
</body>
</html>
